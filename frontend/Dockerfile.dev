# Development Dockerfile for Next.js frontend
FROM node:20-slim

# Install necessary dependencies for Next.js SWC
RUN apt-get update && apt-get install -y \
    python3 \
    make \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy package files for dependency installation
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy the rest of the application
COPY . .

# Create environment variables to disable Telemetry
ENV NEXT_TELEMETRY_DISABLED=1
ENV NODE_ENV=development

# Environment variables needed for next.config.js configuration
ENV USE_DEMO_CONTENT=false
ENV NEXT_PUBLIC_API_URL=http://backend:4000

# Disable Sentry in development to speed up compilation
ENV SENTRY_DSN=""
ENV SENTRY_ORG=pjcdz
ENV SENTRY_PROJECT=studyapp
ENV SENTRY_AUTH_TOKEN=""
ENV CI=false
ENV NEXT_DISABLE_SENTRY=true

# Optimize Next.js for development
ENV NEXT_PRIVATE_STANDALONE=true
ENV NEXT_PRIVATE_LOCAL_WEBPACK=true

# Create uploads directory that might be needed
RUN mkdir -p public/uploads

# Expose the development port
EXPOSE 3000

# Start the development server with optimizations for Docker
CMD ["npm", "run", "dev", "--", "--hostname", "0.0.0.0", "--turbo"]